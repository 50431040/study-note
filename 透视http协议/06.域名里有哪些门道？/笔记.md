# 域名里有哪些门道？

## 域名的解析

DNS 的核心系统是一个三层的树状、分布式服务，基本对应域名的结构：

1. 根域名服务器：管理顶级域名服务器，返回“com”、"net"等顶级域名服务器的 IP 地址

2. 顶级域名服务器：管理各自域名下的权威域名服务器，比如 com 顶级域名服务器跨域返回 apple.com 域名服务器下的 IP 地址

3. 权威域名服务器：管理自己域名下主机的 IP 地址，比如 apple.com 跨域返回 www.apple.com 的 IP 地址。

在核心 DNS 系统之外，还有两种手段用来减轻域名解析的压力，并且能够更快地获取结果，基本思路就是“缓存”。

许多大公司、网络运行商都会建立自己的 DNS 服务器，代替用户访问核心 DNS 系统，可以缓存之前的查询结果。

其次，操作系统也会对 DNS 解析结果做缓存。

在 Nginx 里有这么一条配置指令“resolver”，它就是用来配置 DNS 服务器的，如果没有它，那么 Nginx 就无法查询域名对应的 IP，也就无法反向代理到外部的网站。

```js
resolver 8.8.8.8 valid=30s; #指定Google的DNS，缓存30秒
```

## 域名的“新玩法”

1. 重定向。IP 地址可以任意变动，可以更改 DNS 记录，让域名指向其他机器。

2. 使用 bind9 等开源软件搭建一个在内部使用的 DNS，作为名字服务器。开发的内部服务就可以用域名来标记。

3. 负载均衡。域名解析可以返回多个 IP 地址，所以一个域名可以对应多台主机，客户端收到多个 IP 地址后，可以自己使用轮询算法一次向服务器发起请求，实现负载均衡。另外，域名解析可以配置内部的策略，返回离客户端最近的主机，或者返回当前服务质量最好的主机。