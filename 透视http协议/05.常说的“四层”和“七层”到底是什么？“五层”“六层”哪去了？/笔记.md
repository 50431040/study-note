# 常说的“四层”和“七层”到底是什么？“五层”“六层”哪去了？

## TCP/IP 网络分层模型

TCP/IP 工作由四层，层次顺序“从上往下”：

1. 链接层，负责在以太网、WiFi 这样的底层网络上发送原始数据包，工作在网卡这个层次，使用 MAC 地址来标记网络上的设备。

2. 网际层，IP 协议就在这一层。用 IP 地址取代 MAC 地址，把许多的局域网、广域网连接成一个虚拟的巨大网络，在这个网络里找设备时只要把 IP 地址再“翻译”成 MAC 地址就可以了。

3. 传输层，保证数据在 IP 地址标记的两点之间“可靠”地传输，是 TCP(UDP) 协议工作的层次。TCP 是一个有状态的协议，需要与对方建立连接然后才能发送数据，而且保证数据不丢失不重复。UDP 比较简单，无状态，不用建立连接就可以任意发送数据，但不保证数据一定会发到对方。TCP 的数据是连续的“字节流”，有先后顺序，而 UDP 则是分散的小数据包，顺序发，乱序收。

4. 应用层，有各种面向具体应用的协议。例如 Telnet、SSH、FTP、SMTP、HTTP 等。

## OSI 网络分层模型

分为七层，部分层次与 TCP/IP 很像：

1. 物理层，网络的物理形式，例如电缆、光纤、网卡等。

2. 数据链路层，基本相当于 TCP/IP 的链接层。

3. 网络层，相当于 TCP/IP 的网际层。

4. 传输层，相当于 TCP/IP 的传输层。

5. 会话层，维持网络中的连接状态，即保持会话和同步。

6. 表示层，把数据转换为合适、可理解的语法和语义。

7. 应用层，面向具体的应用传输数据。

## 两个分层模型的映射关系

1. 第一层：物理层，无对应

2. 第二层：数据链路层，对应链接层

3. 第三层：网络层，对应网络层

4. 第四层：传输层，对应传输层

5. 第五、六、七层：对应应用层

所谓的“四层负载均衡”就是指工作在传输层上，基于 TCP/IP 协议的特性，例如 IP 地址、端口号等实现对后端服务的负载均衡。所谓的“七层负载均衡”就是指工作在应用层上，看到的是 HTTP 协议，解析 HTTP 报文里的 URI、主机名、资源类型等数据，再用适当的策略转发给后端服务器。

## TCP/IP 协议栈的工作方式

HTTP 协议的传输过程就是通过协议栈逐层向下，每一层都添加本层的专有数据，层层打包，然后通过下层发送出去。接收数据则相反，从下往上穿过协议栈，逐层拆包，最终拿到数据。

