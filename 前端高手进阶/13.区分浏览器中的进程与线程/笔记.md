# 浏览器中的进程和线程

## 进程（Process）和线程（Thread）

- 进程是操作系统进行资源分配和调度的基本单位。

- 线程是操作系统进行运算的最小单位。

- 一个程序至少有一个进程，一个进程至少有一个线程。线程需要由进程来启动和管理。

- 不同进程之间的资源时独享的，不可用相互访问。这种特性带来的好处就是建立了进程之间的隔离性，避免了多个进程同时操作同一份数据而产生问题。

- 线程之间数据是共享的，也就意味着创建线程的成本更小，因为不需要分配额外的存储空间。进程中任意线程崩溃都会导致整个进程的崩溃。

- 多线程更轻量，多进程更安全稳定。

## 浏览器架构

### 浏览器进程

浏览器的主进程负责界面显示（地址栏、导航栏、书签等）、处理用户事件、管理子进程等。

### GPU 进程

可以利用 GPU 硬件来加速渲染，包括 Canvas 绘制、CSS3 转换（transitions）、CSS3 变换(transform)、WebGL 等。如果 DOM 元素使用了这些属性，GPU 进程就会在合成层的时候对它单独处理，提升到一个独立的层进行绘制，这样能避免重新布局和重新绘制。

### Network Service 进程

负责页面的网络资源加载。本来只是浏览器主进程的一个模块，现在为了将浏览器进程进行“服务化”，被抽取成了一个单独的进程。

### V8 代理解析工具进程

Chrome 支持使用 JavaScript 来写连接代理服务器脚本，称为 pac 代理脚本。解析 pac 脚本要用到 JavaScript 脚本引擎，直接在主进程中引入 JavaScript 引擎不符合“服务化”的设计理念，所以是一个单独的进程。

### 渲染进程

浏览器会为每个标签页单独启动一个渲染进程。所以和上面的不同，并不是只有一个。渲染进程的任务是将 HTML、CSS 和 JavaScript 转化为用户可以与之交互的网页，每个渲染进程都会启动单独的渲染引擎线程和 JavaScript 引擎线程。除此还包括事件触发线程，负责接收事件，并将回调函数放入 JavaScript 引擎线程的事件队列中，以及负责处理定时任务的定时器线程。保障了程序与系统的安全性，也保障了渲染进程的稳定性。

### 扩展程序进程

负责插件的运行，和渲染进程一样，也不是唯一的，会为每个插件都启动一个进程。

### 进程的服务化

Chrome 官方团队在 2016年 提出了面向服务的设计模型，在系统资源允许的情况下，将浏览器主进程的各种模块拆分成单独的服务，每个服务在单独的进程中运行。通过高内聚、低耦合的结构让 Chrome 更安全稳定。同时这种设计也具有一定的伸缩性，当运行在资源有限的设备上时，会将这些服务聚合到浏览器主进程中，从而减少内存占用。

